#!/bin/bash -l
#SBATCH --job-name=samtools-array
#SBATCH --array=1-73
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --time=2-00:00:00
#SBATCH --partition=cpu
#SBATCH --mem-per-cpu=5000MB
#SBATCH --mail-type=END,FAIL
# Autogenerated script from write_samtools_script.R
# date Sun Sep  4 15:02:10 2022
# make sure directory paths exist before running script



module load samtools/1.13-gcc-9.4.0-python-3.8.12



# Parse parameter file to get variables.
           number=$SLURM_ARRAY_TASK_ID
           paramfile=samtools_param.txt
           
           #ins1=`sed -n ${number}p $paramfile | awk '{print $1}'`
           bamfile=`sed -n ${number}p $paramfile | awk '{print $1}'`
           bamq30=`sed -n ${number}p $paramfile | awk '{print $2}'`
           bamq30sortn=`sed -n ${number}p $paramfile | awk '{print $3}'`
           bamq30sortnFixm=`sed -n ${number}p $paramfile | awk '{print $4}'`
           bamq30FixmSortc=`sed -n ${number}p $paramfile | awk '{print $5}'`
           bamrd=`sed -n ${number}p $paramfile | awk '{print $6}'`
           
           # 9. Run the program.
samtools view -b -q 30 $bamfile > $bamq30
samtools sort -n -o $bamq30sortn $bamq30
samtools fixmate -m $bamq30sortn $bamq30sortnFixm
samtools sort -o $bamq30FixmSortc $bamq30sortnFixm
samtools index $bamq30FixmSortc
samtools markdup -r $bamq30FixmSortc $bamrd
samtools index $bamrd



